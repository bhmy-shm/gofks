
熔断器实现与工作思路：（以数据库操作举例）

工作流程 与 概念：
1. 正常操作：
    最开始阶段，熔断器处于关闭状态。每次对数据库进行读写操作时，会通过熔断器的 Do 方法来执行读写，如果成功熔断器会继续保持关闭。
2. 检测失败：
    如果 Do 方法执行的读写操作出现失败，返回了某个错误。熔断器就会记录这个错误。记录错误的方法可以自定义，只针对某些错误进行记录。
3. 计数和决策：
    熔断器内部通常会维护一个计数器来跟踪错误数量。
    如果错误发生的次数，在指定时间窗口内达到了某个阈值；那么熔断器会认为数据库处于不健康的状态。
4.触发熔断：
    到达错误阈值，熔断器会处于 open 状态。后续所有的读写操作都会立即返回，不会操作真实的数据库。保护系统和后端服务不受进一步压力。
5.等待重试：
    熔断器打开后，不会立即再次关闭。会进入一个预设的 “冷却时间”。在这段时间内，所有尝试通过 Do 方法的操作都会被拒绝。
    冷却时间过后，熔断器进入“半开Half-open” 状态，允许一定数量的操作尝试执行；
    如果这些操作都成功，则熔断器认为后端服务健康，再次进入关闭状态
总结：
    熔断器会根据内部状态机来处理，一定会包含以下几种状态：
    1. 记录错误，错误计数器
    2. 状态检查，检查当前熔断器状态
    3. 状态转换，根据计数器和时间窗口，决定是否需要转换状态。（关闭-打开。打开-半打开。半打开-关闭）


补充：
    go-zero 实现的熔断器中，并没有状态 开 闭 半开。
    而是通过 rollingwindow 滑动窗口中的 请求统计结果来进行计算，计算是否应该接收新的请求。
    如果计算的概率应该拒绝请求，则返回一个错误 ErrServiceUnavailable 。某种意义上实现了“开”状态。